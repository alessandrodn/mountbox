#!/bin/sh
set -e
REPO="alessandrodn/mountbox"
FORCE=""
for arg in "$@"; do
    case "$arg" in
        --force) FORCE="--force" ;;
    esac
done

echo "Checking latest version..."
VERSION=$(wget -qO- "https://api.github.com/repos/$REPO/releases/latest" \
  | grep '"tag_name"' | sed 's/.*"v//;s/".*//')

if [ -z "$VERSION" ]; then
    echo "Error: Could not determine latest version."
    exit 1
fi

echo "Updating MountBox to v${VERSION}..."
wget -qO- "https://raw.githubusercontent.com/$REPO/v${VERSION}/setup.sh" | VERSION=$VERSION sh -s -- $FORCE
